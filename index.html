<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Controle Acadêmico Universitário - Direito</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #1a3a6c;
      --secondary: #2d5b8f;
      --accent: #9d7b5f;
      --light: #f8f9fa;
      --dark: #212529;
      --success: #28a745;
      --warning: #ffc107;
      --danger: #dc3545;
      --info: #17a2b8;
      --light-accent: #e9e1d9;
      --text-dark: #333;
      --text-light: #6c757d;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }

    body {
      background-color: #f5f7fb;
      font-family: 'Poppins', sans-serif;
      color: var(--text-dark);
      line-height: 1.6;
    }

    h1, h2, h3, h4, h5, h6 {
      font-family: 'Playfair Display', serif;
      color: var(--primary);
    }

    .app-container {
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 280px;
      background: linear-gradient(to bottom, var(--primary), var(--secondary));
      color: white;
      padding: 20px 0;
      box-shadow: var(--shadow);
      z-index: 1000;
      transition: var(--transition);
      overflow-y: auto;
    }

    .sidebar-header {
      padding: 0 20px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 20px;
    }

    .sidebar-logo {
      font-family: 'Playfair Display', serif;
      font-size: 1.8rem;
      margin-bottom: 5px;
    }

    .sidebar-subtitle {
      font-size: 0.9rem;
      opacity: 0.8;
    }

    .nav-item {
      margin: 5px 15px;
      border-radius: 8px;
      transition: var(--transition);
    }

    .nav-item:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .nav-link {
      color: white;
      padding: 12px 15px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      transition: var(--transition);
    }

    .nav-link:hover, .nav-link.active {
      background-color: rgba(255, 255, 255, 0.15);
      color: white;
    }

    .nav-link i {
      width: 24px;
      margin-right: 12px;
      font-size: 1.1rem;
    }

    .main-content {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
      transition: var(--transition);
    }

    .content-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--light-accent);
    }

    .card-link {
      transition: transform 0.2s, box-shadow 0.2s;
      cursor: pointer;
      border-radius: 12px;
      box-shadow: var(--shadow);
      color: var(--dark);
      border: none;
      height: 100%;
      background: white;
    }

    .card-link:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }

    .card-link .card-body {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      padding: 20px;
    }

    .card-link .icon-wrapper {
      background-color: var(--primary);
      color: white;
      padding: 1rem;
      border-radius: 10px;
      margin-right: 1rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 60px;
      height: 60px;
    }

    .card-link h5 {
      margin-bottom: 0;
      font-weight: 600;
    }

    .content-panel {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .content-panel.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .card-dashboard {
      border-radius: 12px;
      border: none;
      box-shadow: var(--shadow);
      transition: var(--transition);
      background: white;
      height: 100%;
    }

    .card-dashboard:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }

    .card-dashboard .card-body {
      padding: 1.5rem;
    }

    .progress {
      height: 10px;
      border-radius: 5px;
      background-color: #e9ecef;
    }

    .event-calendar {
      background-color: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: var(--shadow);
    }

    .calendar-day {
      text-align: center;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s;
      position: relative;
    }

    .calendar-day:not(.empty):hover {
      background-color: #e9ecef;
    }

    .calendar-day.has-event {
      background-color: rgba(26, 58, 108, 0.1);
      color: var(--primary);
      font-weight: bold;
    }

    .calendar-day.current {
      background-color: var(--primary);
      color: white;
    }

    .event-indicator {
      position: absolute;
      bottom: 2px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      gap: 2px;
    }

    .event-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      display: inline-block;
    }

    .event-dot.assignment {
      background-color: var(--info);
    }

    .event-dot.exam {
      background-color: var(--danger);
    }

    .event-dot.other {
      background-color: var(--warning);
    }

    .badge-priority {
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.7rem;
      color: white;
    }

    .priority-high {
      background-color: var(--danger);
    }

    .priority-medium {
      background-color: var(--warning);
      color: #333;
    }

    .priority-low {
      background-color: var(--success);
    }

    .avg-grade-badge {
      font-size: 1.25rem;
      font-weight: bold;
      padding: 0.5rem 1rem;
      border-radius: 10px;
    }

    .btn-primary {
      background-color: var(--primary);
      border-color: var(--primary);
    }

    .btn-primary:hover {
      background-color: var(--secondary);
      border-color: var(--secondary);
    }

    .btn-outline-primary {
      color: var(--primary);
      border-color: var(--primary);
    }

    .btn-outline-primary:hover {
      background-color: var(--primary);
      color: white;
    }

    .table th {
      font-weight: 600;
      color: var(--primary);
      border-top: none;
    }

    .modal-content {
      border-radius: 12px;
      border: none;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .modal-header {
      background-color: var(--primary);
      color: white;
      border-radius: 12px 12px 0 0;
    }

    .modal-title {
      font-weight: 600;
    }

    .stats-card {
      display: flex;
      align-items: center;
    }

    .stats-card i {
      font-size: 2.5rem;
      opacity: 0.8;
    }

    .stats-info {
      margin-left: 15px;
    }

    .stats-info h4 {
      margin-bottom: 0;
      font-weight: 700;
    }

    .stats-info p {
      margin-bottom: 0;
      color: var(--text-light);
      font-size: 0.9rem;
    }

    .event-item {
      border-left: 4px solid var(--primary);
      padding: 10px 15px;
      margin-bottom: 10px;
      background-color: white;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      cursor: pointer;
      transition: all 0.2s;
    }

    .event-item:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .event-item.assignment {
      border-left-color: var(--info);
    }

    .event-item.exam {
      border-left-color: var(--danger);
    }

    .event-item.other {
      border-left-color: var(--warning);
    }

    .event-item.completed {
      opacity: 0.7;
      border-left-color: var(--success);
    }

    .report-section {
      margin-bottom: 30px;
    }

    .report-header {
      background-color: var(--primary);
      color: white;
      padding: 10px 15px;
      border-radius: 8px 8px 0 0;
      margin-bottom: 0;
    }

    .report-body {
      padding: 15px;
      background-color: white;
      border-radius: 0 0 8px 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .report-item {
      padding: 10px 15px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .empty-state {
      padding: 20px;
      text-align: center;
      color: var(--text-light);
    }
    
    /* ESTILOS QUADRO DE HORÁRIOS */
    .schedule-grid-wrapper {
        overflow-x: auto;
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: var(--shadow);
    }

    .schedule-grid {
        display: grid;
        grid-template-columns: 80px repeat(6, 1fr); /* Horas + 6 dias */
        grid-auto-rows: 50px;
        gap: 5px;
        min-width: 800px;
    }

    .schedule-header, .schedule-time-slot {
        background-color: var(--primary);
        color: white;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        font-size: 0.9rem;
        padding: 5px;
    }

    .schedule-time-slot {
        background-color: var(--light-accent);
        color: var(--text-dark);
        font-size: 0.8rem;
    }

    .schedule-grid > div:first-child {
        background: transparent;
    }
    
    .schedule-class-item {
        position: relative;
        background-color: var(--secondary);
        color: white;
        border-radius: 8px;
        padding: 8px;
        font-size: 0.8rem;
        overflow: hidden;
        cursor: pointer;
        transition: var(--transition);
        border-left: 5px solid var(--primary);
    }
    .schedule-class-item:hover {
        opacity: 0.9;
        transform: scale(1.02);
    }
    .schedule-class-title {
        font-weight: 600;
        margin-bottom: 2px;
    }
    .schedule-class-details {
        font-size: 0.75rem;
        opacity: 0.9;
    }


    /* Responsividade */
    @media (max-width: 992px) {
      .app-container {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        height: auto;
        position: fixed;
        bottom: 0;
        z-index: 1000;
        padding: 10px 0;
      }

      .sidebar-header {
        display: none;
      }

      .nav-menu {
        display: flex;
        overflow-x: auto;
        padding: 0 10px;
      }

      .nav-item {
        margin: 0 5px;
        flex-shrink: 0;
      }

      .nav-link {
        flex-direction: column;
        padding: 10px;
        font-size: 0.8rem;
      }

      .nav-link i {
        margin-right: 0;
        margin-bottom: 5px;
        font-size: 1.2rem;
      }

      .main-content {
        padding: 20px 15px 80px;
      }
    }

    @media (max-width: 768px) {
      .content-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .content-header .btn-group {
        margin-top: 15px;
        align-self: flex-end;
      }

      .card-link .card-body {
        padding: 15px;
      }

      .card-link .icon-wrapper {
        width: 50px;
        height: 50px;
      }

      .stats-card {
        flex-direction: column;
        text-align: center;
      }

      .stats-info {
        margin-left: 0;
        margin-top: 10px;
      }
    }

    .sidebar-toggle {
      display: none;
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1001;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background-color: var(--primary);
      color: white;
      border: none;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    @media (max-width: 992px) {
      .sidebar-toggle {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .sidebar {
        transform: translateY(100%);
        transition: transform 0.3s ease;
      }
      .sidebar.open {
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
<div class="app-container">
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">Lex Academica</div>
      <div class="sidebar-subtitle">Controle Acadêmico Jurídico</div>
    </div>
    <nav>
      <div class="nav-menu">
        <div class="nav-item">
          <a class="nav-link active" href="#" data-target="home-links">
            <i class="fas fa-home"></i>
            <span>Início</span>
          </a>
        </div>
        <div class="nav-item">
          <a class="nav-link" href="#" data-target="dashboard">
            <i class="fas fa-chart-line"></i>
            <span>Dashboard</span>
          </a>
        </div>
        <div class="nav-item">
          <a class="nav-link" href="#" data-target="disciplinas">
            <i class="fas fa-book"></i>
            <span>Disciplinas</span>
          </a>
        </div>
        <div class="nav-item">
            <a class="nav-link" href="#" data-target="horarios">
                <i class="fas fa-table-cells"></i>
                <span>Horários</span>
            </a>
        </div>
        <div class="nav-item">
          <a class="nav-link" href="#" data-target="trabalhos">
            <i class="fas fa-tasks"></i>
            <span>Trabalhos</span>
          </a>
        </div>
        <div class="nav-item">
          <a class="nav-link" href="#" data-target="provas">
            <i class="fas fa-file-alt"></i>
            <span>Provas</span>
          </a>
        </div>
        <div class="nav-item">
          <a class="nav-link" href="#" data-target="agenda">
            <i class="fas fa-calendar-alt"></i>
            <span>Agenda</span>
          </a>
        </div>
        <div class="nav-item">
          <a class="nav-link" href="#" data-target="relatorios">
            <i class="fas fa-chart-pie"></i>
            <span>Relatórios</span>
          </a>
        </div>
         <div class="nav-item">
          <a class="nav-link" href="#" data-target="configuracoes">
            <i class="fas fa-cog"></i>
            <span>Configurações</span>
          </a>
        </div>
      </div>
    </nav>
  </aside>

  <main class="main-content">
    <button class="sidebar-toggle" id="sidebarToggle">
      <i class="fas fa-bars"></i>
    </button>

    <div class="content-panel active" id="home-links">
      <div class="content-header">
        <h2>Início</h2>
      </div>
      <div class="row g-4">
        </div>
    </div>

    <div class="content-panel" id="dashboard">
        <div class="content-header">
            <h2>Dashboard</h2>
        </div>
        <div class="row g-4 mb-4">
            <div class="col-md-6 col-lg-3">
                <div class="card card-dashboard">
                    <div class="card-body">
                        <div class="stats-card">
                            <i class="fas fa-book text-primary"></i>
                            <div class="stats-info">
                                <h4 id="dashboard-disciplinas-count">0</h4>
                                <p>Disciplinas</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card card-dashboard">
                    <div class="card-body">
                        <div class="stats-card">
                            <i class="fas fa-tasks text-info"></i>
                            <div class="stats-info">
                                <h4 id="dashboard-trabalhos-pendentes">0</h4>
                                <p>Trabalhos Pendentes</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card card-dashboard">
                    <div class="card-body">
                        <div class="stats-card">
                            <i class="fas fa-file-alt text-warning"></i>
                            <div class="stats-info">
                                <h4 id="dashboard-provas-agendadas">0</h4>
                                <p>Provas Agendadas</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="card card-dashboard">
                    <div class="card-body">
                        <div class="stats-card">
                            <i class="fas fa-chart-line text-success"></i>
                            <div class="stats-info">
                                <h4 id="dashboard-media-geral">0.0</h4>
                                <p>Média Geral</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row g-4">
            <div class="col-lg-8">
                <div class="card card-dashboard">
                    <div class="card-body">
                        <h4 class="card-title mb-4">Desempenho por Disciplina</h4>
                        <div id="dashboard-desempenho-disciplinas">
                            <div class="empty-state">
                                <p>Nenhuma disciplina cadastrada.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card card-dashboard">
                    <div class="card-body">
                        <h4 class="card-title mb-4">Próximos Eventos</h4>
                        <div id="dashboard-proximos-eventos">
                            <div class="empty-state">
                                <p>Nenhum evento próximo.</p>
                            </div>
                        </div>
                        <a href="#" class="btn btn-outline-primary btn-sm mt-3" data-target="agenda">Ver Agenda Completa</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="content-panel" id="disciplinas">
      <div class="content-header">
        <h2>Disciplinas</h2>
        <div class="btn-group">
          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#disciplinaModal">
            <i class="fas fa-plus"></i> Nova Disciplina
          </button>
        </div>
      </div>
      <div class="row g-4" id="disciplinas-lista">
        </div>
    </div>

    <div class="content-panel" id="horarios">
        <div class="content-header">
            <h2>Quadro de Horários</h2>
            <div class="btn-group">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#horarioModal">
                    <i class="fas fa-plus"></i> Nova Aula
                </button>
            </div>
        </div>
        <div class="schedule-grid-wrapper">
            <div class="schedule-grid" id="schedule-grid-container">
                </div>
        </div>
    </div>

    <div class="content-panel" id="trabalhos">
      <div class="content-header">
        <h2>Trabalhos</h2>
        <div class="btn-group">
           <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#trabalhoModal">
            <i class="fas fa-plus"></i> Novo Trabalho
          </button>
        </div>
      </div>
      <div class="card card-dashboard">
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Disciplina</th>
                  <th>Título</th>
                  <th>Entrega</th>
                  <th>Status</th>
                  <th>Prioridade</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="trabalhos-tabela"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="content-panel" id="provas">
        <div class="content-header">
            <h2>Provas</h2>
            <div class="btn-group">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#provaModal">
                    <i class="fas fa-plus"></i> Nova Prova
                </button>
            </div>
        </div>
        <div class="card card-dashboard">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Disciplina</th>
                                <th>Conteúdo</th>
                                <th>Data</th>
                                <th>Hora</th>
                                <th>Status</th>
                                <th>Nota</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="provas-tabela"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="content-panel" id="agenda">
        <div class="content-header">
            <h2>Agenda</h2>
            <div class="btn-group">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#eventModal">
                    <i class="fas fa-plus"></i> Novo Evento
                </button>
            </div>
        </div>
        <div class="row g-4">
            <div class="col-lg-8">
                <div class="card card-dashboard">
                    <div class="card-body">
                        <div class="event-calendar">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <button class="btn btn-sm btn-outline-primary" id="prev-month">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <h5 class="mb-0" id="calendar-month-year"></h5>
                                <button class="btn btn-sm btn-outline-primary" id="next-month">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                            <div class="row mb-2" id="calendar-weekdays"></div>
                            <div id="calendar-days"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="card card-dashboard">
                    <div class="card-body" id="agenda-eventos-dia">
                        <h4 class="card-title mb-4">Eventos do Dia</h4>
                        <p class="text-muted text-center">Selecione um dia no calendário</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="content-panel" id="relatorios">
        <div class="content-header">
            <h2>Relatórios</h2>
        </div>
        <div class="row g-4">
            <div class="col-lg-6">
                <div class="report-section">
                    <h4 class="report-header">Desempenho por Disciplina</h4>
                    <div class="report-body" id="relatorio-desempenho"></div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="report-section">
                    <h4 class="report-header">Frequência</h4>
                    <div class="report-body" id="relatorio-frequencia"></div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="report-section">
                    <h4 class="report-header">Trabalhos Entregues</h4>
                    <div class="report-body" id="relatorio-trabalhos"></div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="report-section">
                    <h4 class="report-header">Provas Realizadas</h4>
                    <div class="report-body" id="relatorio-provas"></div>
                </div>
            </div>
        </div>
    </div>
      
    <div class="content-panel" id="configuracoes">
        <div class="content-header">
            <h2>Configurações</h2>
        </div>
        <div class="card card-dashboard">
            <div class="card-body">
                <h4 class="card-title">Backup e Restauração de Dados</h4>
                <p class="text-muted">Salve seus dados em um arquivo para segurança ou para transferir para outro dispositivo.</p>
                <div class="mt-4">
                    <button class="btn btn-primary" id="backup-btn">
                        <i class="fas fa-download"></i> Criar Backup (Exportar)
                    </button>
                    <label for="restore-input" class="btn btn-outline-primary ms-2">
                        <i class="fas fa-upload"></i> Restaurar Backup (Importar)
                    </label>
                    <input type="file" id="restore-input" class="d-none" accept=".json">
                </div>
                <div class="alert alert-warning mt-4">
                    <strong>Atenção:</strong> Restaurar um backup substituirá todos os dados atuais. Esta ação não pode ser desfeita.
                </div>
            </div>
        </div>
    </div>

  </main>
</div>

<div class="modal fade" id="horarioModal" tabindex="-1" aria-labelledby="horarioModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="horarioModalLabel">Nova Aula</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="horarioForm">
                    <input type="hidden" id="horarioId">
                    <div class="mb-3">
                        <label for="horarioDisciplina" class="form-label">Disciplina</label>
                        <select class="form-select" id="horarioDisciplina" required></select>
                    </div>
                    <div class="mb-3">
                        <label for="horarioDiaSemana" class="form-label">Dia da Semana</label>
                        <select class="form-select" id="horarioDiaSemana" required>
                            <option value="1">Segunda-feira</option>
                            <option value="2">Terça-feira</option>
                            <option value="3">Quarta-feira</option>
                            <option value="4">Quinta-feira</option>
                            <option value="5">Sexta-feira</option>
                            <option value="6">Sábado</option>
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-6 mb-3">
                            <label for="horarioInicio" class="form-label">Hora de Início</label>
                            <input type="time" class="form-control" id="horarioInicio" step="1800" required>
                        </div>
                        <div class="col-6 mb-3">
                            <label for="horarioFim" class="form-label">Hora de Fim</label>
                            <input type="time" class="form-control" id="horarioFim" step="1800" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="horarioLocal" class="form-label">Local / Sala</label>
                        <input type="text" class="form-control" id="horarioLocal">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                 <button type="button" class="btn btn-danger me-auto d-none" id="deleteHorario">Excluir</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="saveHorario">Salvar</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="disciplinaModal" tabindex="-1" aria-labelledby="disciplinaModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="disciplinaModalLabel">Nova Disciplina</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="disciplinaForm">
                    <input type="hidden" id="disciplinaId">
                    <div class="mb-3">
                        <label for="disciplinaNome" class="form-label">Nome da Disciplina</label>
                        <input type="text" class="form-control" id="disciplinaNome" required>
                    </div>
                    <div class="mb-3">
                        <label for="disciplinaProfessor" class="form-label">Professor(a)</label>
                        <input type="text" class="form-control" id="disciplinaProfessor">
                    </div>
                     <div class="mb-3">
                        <label for="disciplinaFrequencia" class="form-label">Frequência (%)</label>
                        <input type="number" class="form-control" id="disciplinaFrequencia" min="0" max="100" value="100">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="saveDisciplina">Salvar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="trabalhoModal" tabindex="-1" aria-labelledby="trabalhoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="trabalhoModalLabel">Novo Trabalho</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="trabalhoForm">
                    <input type="hidden" id="trabalhoId">
                    <div class="mb-3">
                        <label for="trabalhoDisciplina" class="form-label">Disciplina</label>
                        <select class="form-select" id="trabalhoDisciplina" required></select>
                    </div>
                    <div class="mb-3">
                        <label for="trabalhoTitulo" class="form-label">Título</label>
                        <input type="text" class="form-control" id="trabalhoTitulo" required>
                    </div>
                    <div class="mb-3">
                        <label for="trabalhoEntrega" class="form-label">Data de Entrega</label>
                        <input type="date" class="form-control" id="trabalhoEntrega" required>
                    </div>
                    <div class="mb-3">
                        <label for="trabalhoStatus" class="form-label">Status</label>
                        <select class="form-select" id="trabalhoStatus">
                            <option value="Pendente">Pendente</option>
                            <option value="Entregue">Entregue</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="trabalhoPrioridade" class="form-label">Prioridade</label>
                         <select class="form-select" id="trabalhoPrioridade">
                            <option value="low">Baixa</option>
                            <option value="medium" selected>Média</option>
                            <option value="high">Alta</option>
                        </select>
                    </div>
                     <div class="mb-3">
                        <label for="trabalhoNota" class="form-label">Nota (0 a 10)</label>
                        <input type="number" step="0.1" class="form-control" id="trabalhoNota" min="0" max="10">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="saveTrabalho">Salvar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="provaModal" tabindex="-1" aria-labelledby="provaModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="provaModalLabel">Nova Prova</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="provaForm">
                    <input type="hidden" id="provaId">
                    <div class="mb-3">
                        <label for="provaDisciplina" class="form-label">Disciplina</label>
                        <select class="form-select" id="provaDisciplina" required></select>
                    </div>
                    <div class="mb-3">
                        <label for="provaConteudo" class="form-label">Conteúdo</label>
                        <input type="text" class="form-control" id="provaConteudo" required>
                    </div>
                    <div class="mb-3">
                        <label for="provaData" class="form-label">Data</label>
                        <input type="date" class="form-control" id="provaData" required>
                    </div>
                    <div class="mb-3">
                        <label for="provaHora" class="form-label">Hora</label>
                        <input type="time" class="form-control" id="provaHora">
                    </div>
                    <div class="mb-3">
                        <label for="provaStatus" class="form-label">Status</label>
                        <select class="form-select" id="provaStatus">
                            <option value="Agendada">Agendada</option>
                            <option value="Realizada">Realizada</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="provaNota" class="form-label">Nota (0 a 10)</label>
                        <input type="number" step="0.1" class="form-control" id="provaNota" min="0" max="10">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="saveProva">Salvar</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="eventModalLabel">Novo Evento</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="eventForm">
            <input type="hidden" id="eventId">
          <div class="mb-3">
            <label for="eventTitle" class="form-label">Título do Evento</label>
            <input type="text" class="form-control" id="eventTitle" required>
          </div>
          <div class="mb-3">
            <label for="eventType" class="form-label">Tipo de Evento</label>
            <select class="form-select" id="eventType" required>
              <option value="other" selected>Outro</option>
              <option value="assignment">Trabalho</option>
              <option value="exam">Prova</option>
              <option value="class">Aula</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="eventDate" class="form-label">Data</label>
            <input type="date" class="form-control" id="eventDate" required>
          </div>
          <div class="mb-3">
            <label for="eventTime" class="form-label">Hora (opcional)</label>
            <input type="time" class="form-control" id="eventTime">
          </div>
          <div class="mb-3">
            <label for="eventDescription" class="form-label">Descrição</label>
            <textarea class="form-control" id="eventDescription" rows="3"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" id="saveEvent">Salvar Evento</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// SCRIPT COMPLETO DA APLICAÇÃO
document.addEventListener('DOMContentLoaded', function() {
    
    //-----------------------------------------------------
    // 1. INICIALIZAÇÃO E GERENCIAMENTO DE DADOS (localStorage)
    //-----------------------------------------------------
    let db;
    let currentCalendarDate = new Date();

    const initialData = {
        disciplinas: [
            { id: 1, nome: "Direito Civil", professor: "Prof. Dr. Carlos Albuquerque", frequencia: 85 },
            { id: 2, nome: "Direito Constitucional", professor: "Prof. Dra. Maria Santos", frequencia: 92 },
            { id: 3, nome: "Direito Penal", professor: "Prof. Dr. Roberto Ferreira", frequencia: 88 },
            { id: 4, nome: "Direito Trabalhista", professor: "Prof. Dra. Ana Costa", frequencia: 75 }
        ],
        horarios: [
            { id: 1, disciplinaId: 1, diaSemana: 1, inicio: "08:00", fim: "10:00", local: "Sala 101" },
            { id: 2, disciplinaId: 3, diaSemana: 1, inicio: "10:00", fim: "12:00", local: "Sala 102" },
            { id: 3, disciplinaId: 2, diaSemana: 3, inicio: "08:00", fim: "12:00", local: "Auditório" },
            { id: 4, disciplinaId: 4, diaSemana: 5, inicio: "14:00", fim: "16:00", local: "Sala 205" }
        ],
        trabalhos: [
            { id: 1, disciplinaId: 1, titulo: "Estudo de Caso - Contratos", entrega: "2025-09-25", status: "Pendente", prioridade: "high", nota: null },
            { id: 2, disciplinaId: 3, titulo: "Artigo - Teoria do Crime", entrega: "2025-10-10", status: "Pendente", prioridade: "medium", nota: null }
        ],
        provas: [
            { id: 1, disciplinaId: 3, conteudo: "Teoria Geral do Crime", data: "2025-10-15", hora: "14:00", status: "Agendada", nota: null },
            { id: 2, disciplinaId: 1, conteudo: "Obrigações", data: "2025-10-20", hora: "10:00", status: "Agendada", nota: null }
        ],
        eventos: [
            { id: 1, title: "Seminário Internacional", type: 'other', date: "2025-09-30", time: "09:00", description: "Auditório Central" }
        ]
    };

    function init() {
        const storedData = localStorage.getItem('lexAcademicaDB');
        if (storedData) {
            db = JSON.parse(storedData);
        } else {
            db = initialData;
        }
        // Garante que novas estruturas de dados sejam adicionadas se não existirem no DB salvo
        if (!db.horarios) db.horarios = [];

        saveDB();
        generateQuickLinks();
        renderAll();
    }

    function saveDB() {
        localStorage.setItem('lexAcademicaDB', JSON.stringify(db));
    }

    //-----------------------------------------------------
    // 2. FUNÇÕES DE RENDERIZAÇÃO GERAL
    //-----------------------------------------------------
    function renderAll() {
        renderDashboard();
        renderDisciplinas();
        renderHorarios();
        renderTrabalhos();
        renderProvas();
        renderAgenda();
        renderRelatorios();
        populateDisciplinaSelects();
    }

    function getDisciplinaById(id) {
        return db.disciplinas.find(d => d.id === parseInt(id));
    }

    const disciplinaColors = {};
    const colorPalette = ["#1a3a6c", "#2d5b8f", "#9d7b5f", "#17a2b8", "#28a745", "#ffc107", "#dc3545", "#6f42c1"];

    function getDisciplinaColor(disciplinaId) {
        if (!disciplinaColors[disciplinaId]) {
            disciplinaColors[disciplinaId] = colorPalette[Object.keys(disciplinaColors).length % colorPalette.length];
        }
        return disciplinaColors[disciplinaId];
    }
    
    //-----------------------------------------------------
    // 3. RENDERIZAÇÃO DOS PAINÉIS
    //-----------------------------------------------------

    function generateQuickLinks() {
        const container = document.getElementById('home-links').querySelector('.row');
        container.innerHTML = '';
        document.querySelectorAll('.sidebar .nav-link').forEach(link => {
            const target = link.dataset.target;
            if (target === 'home-links') return;
            const iconClass = link.querySelector('i').className;
            const title = link.querySelector('span').textContent;

            container.innerHTML += `
                <div class="col-md-6 col-lg-3">
                  <div class="card card-link" data-target="${target}">
                    <div class="card-body">
                      <div class="icon-wrapper">
                        <i class="${iconClass}"></i>
                      </div>
                      <h5>${title}</h5>
                    </div>
                  </div>
                </div>
            `;
        });
    }

    function renderDashboard() {
        // Cards de estatísticas
        const trabalhosPendentes = db.trabalhos.filter(t => t.status === 'Pendente').length;
        const provasAgendadas = db.provas.filter(p => p.status === 'Agendada').length;

        document.getElementById('dashboard-disciplinas-count').textContent = db.disciplinas.length;
        document.getElementById('dashboard-trabalhos-pendentes').textContent = trabalhosPendentes;
        document.getElementById('dashboard-provas-agendadas').textContent = provasAgendadas;
        
        // Média Geral
        let todasNotas = [];
        db.trabalhos.forEach(t => { if(t.nota !== null) todasNotas.push(parseFloat(t.nota))});
        db.provas.forEach(p => { if(p.nota !== null) todasNotas.push(parseFloat(p.nota))});
        const mediaGeral = todasNotas.length > 0 ? (todasNotas.reduce((a, b) => a + b, 0) / todasNotas.length).toFixed(1) : "0.0";
        document.getElementById('dashboard-media-geral').textContent = mediaGeral;

        // Desempenho por disciplina
        const desempenhoContainer = document.getElementById('dashboard-desempenho-disciplinas');
        desempenhoContainer.innerHTML = '';
        if (db.disciplinas.length === 0) {
            desempenhoContainer.innerHTML = `<div class="empty-state"><p>Nenhuma disciplina cadastrada.</p></div>`;
        } else {
            db.disciplinas.forEach(d => {
                const notasTrabalhos = db.trabalhos.filter(t => t.disciplinaId === d.id && t.nota !== null).map(t => parseFloat(t.nota));
                const notasProvas = db.provas.filter(p => p.disciplinaId === d.id && p.nota !== null).map(p => parseFloat(p.nota));
                const notasDisciplina = [...notasTrabalhos, ...notasProvas];
                const mediaDisciplina = notasDisciplina.length > 0 ? (notasDisciplina.reduce((a, b) => a + b, 0) / notasDisciplina.length).toFixed(1) : "N/A";
                const progressWidth = mediaDisciplina !== "N/A" ? (mediaDisciplina / 10 * 100) : 0;
                
                const barColor = progressWidth >= 70 ? 'bg-success' : progressWidth >= 50 ? 'bg-warning' : 'bg-danger';

                desempenhoContainer.innerHTML += `
                    <p class="small mb-1">${d.nome} - Média: ${mediaDisciplina}</p>
                    <div class="progress mb-3">
                        <div class="progress-bar ${barColor}" role="progressbar" style="width: ${progressWidth}%" aria-valuenow="${progressWidth}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                `;
            });
        }
        
        // Próximos eventos
        const eventosContainer = document.getElementById('dashboard-proximos-eventos');
        eventosContainer.innerHTML = '';
        const hoje = new Date().toISOString().split('T')[0];
        const todosEventos = [
            ...db.trabalhos.filter(t => t.status === 'Pendente').map(t => ({...t, type: 'assignment', date: t.entrega, title: t.titulo})),
            ...db.provas.filter(p => p.status === 'Agendada').map(p => ({...p, type: 'exam', date: p.data, title: p.conteudo})),
            ...db.eventos.map(e => ({...e}))
        ];
        
        const proximosEventos = todosEventos.filter(e => e.date >= hoje).sort((a,b) => new Date(a.date) - new Date(b.date)).slice(0, 3);
        
        if (proximosEventos.length === 0) {
            eventosContainer.innerHTML = `<div class="empty-state"><p>Nenhum evento próximo.</p></div>`;
        } else {
            proximosEventos.forEach(evento => {
                let badge = '';
                if(evento.prioridade) {
                    const priorityClass = evento.prioridade === 'high' ? 'priority-high' : evento.prioridade === 'medium' ? 'priority-medium' : 'priority-low';
                    const priorityText = evento.prioridade === 'high' ? 'Alta' : evento.prioridade === 'medium' ? 'Média' : 'Baixa';
                    badge = `<span class="badge ${priorityClass}">${priorityText}</span>`;
                }
                eventosContainer.innerHTML += `
                    <div class="event-item ${evento.type}">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">${evento.title}</h6>
                            ${badge}
                        </div>
                        <p class="mb-0 small">Data: ${new Date(evento.date + 'T00:00:00').toLocaleDateString('pt-BR')}</p>
                    </div>
                `;
            });
        }
    }

    function renderDisciplinas() {
        const container = document.getElementById('disciplinas-lista');
        container.innerHTML = '';
        if (db.disciplinas.length === 0) {
            container.innerHTML = `<div class="col-12"><div class="empty-state card-dashboard p-4"><p>Clique em "Nova Disciplina" para começar.</p></div></div>`;
            return;
        }
        db.disciplinas.forEach(d => {
            const notasTrabalhos = db.trabalhos.filter(t => t.disciplinaId === d.id && t.nota !== null).map(t => parseFloat(t.nota));
            const notasProvas = db.provas.filter(p => p.disciplinaId === d.id && p.nota !== null).map(p => parseFloat(p.nota));
            const notasDisciplina = [...notasTrabalhos, ...notasProvas];
            const mediaDisciplina = notasDisciplina.length > 0 ? (notasDisciplina.reduce((a, b) => a + b, 0) / notasDisciplina.length).toFixed(1) : "N/A";
            const progressWidth = mediaDisciplina !== "N/A" ? (mediaDisciplina / 10 * 100) : 0;
            const barColor = progressWidth >= 70 ? 'bg-success' : progressWidth >= 50 ? 'bg-warning' : 'bg-danger';

            const card = `
                <div class="col-md-6 col-lg-4">
                  <div class="card card-dashboard">
                    <div class="card-body">
                      <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                          <h4 class="card-title mb-0">${d.nome}</h4>
                           <p class="text-muted small">${d.professor}</p>
                        </div>
                        <div class="dropdown">
                          <button class="btn btn-sm btn-light" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-ellipsis-v"></i>
                          </button>
                          <ul class="dropdown-menu">
                            <li><a class="dropdown-item edit-disciplina" href="#" data-id="${d.id}">Editar</a></li>
                            <li><a class="dropdown-item delete-disciplina" href="#" data-id="${d.id}">Excluir</a></li>
                          </ul>
                        </div>
                      </div>
                       <div class="d-flex justify-content-between small text-muted mb-2">
                        <span>Média</span>
                        <span class="avg-grade-badge ${barColor} text-white">${mediaDisciplina}</span>
                      </div>
                      <div class="progress mb-3">
                        <div class="progress-bar ${barColor}" role="progressbar" style="width: ${progressWidth}%"></div>
                      </div>
                      
                      <div class="d-flex justify-content-between small text-muted mb-2">
                        <span>Frequência</span>
                        <span>${d.frequencia}%</span>
                      </div>
                      <div class="progress mb-3">
                        <div class="progress-bar bg-primary" role="progressbar" style="width: ${d.frequencia}%"></div>
                      </div>
                      
                      <div class="d-flex justify-content-between">
                        <span class="badge bg-primary">${db.trabalhos.filter(t => t.disciplinaId === d.id).length} Trabalhos</span>
                        <span class="badge bg-warning">${db.provas.filter(p => p.disciplinaId === d.id).length} Provas</span>
                      </div>
                    </div>
                  </div>
                </div>
            `;
            container.innerHTML += card;
        });
    }

    function renderHorarios() {
        const container = document.getElementById('schedule-grid-container');
        container.innerHTML = '';
        
        // Define range de horas
        const horaInicio = 7;
        const horaFim = 22;
        const totalRows = (horaFim - horaInicio) * 2 + 1; // 30 min slots
        container.style.gridTemplateRows = `50px repeat(${totalRows -1}, 40px)`;
        
        // Cabeçalho
        container.innerHTML += `<div></div>`; // Canto vazio
        const dias = ['Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'];
        dias.forEach(dia => container.innerHTML += `<div class="schedule-header">${dia}</div>`);

        // Coluna de horas
        for (let i = horaInicio; i <= horaFim; i++) {
             container.innerHTML += `<div class="schedule-time-slot" style="grid-row: ${ (i - horaInicio) * 2 + 2 } / span 2">${String(i).padStart(2,'0')}:00</div>`;
        }

        // Aulas
        if (db.horarios.length === 0) {
            const emptyState = document.createElement('div');
            emptyState.className = 'empty-state';
            emptyState.textContent = 'Nenhuma aula cadastrada.';
            emptyState.style.gridColumn = '2 / span 6';
            emptyState.style.gridRow = '2 / span 4';
            container.appendChild(emptyState);
        } else {
            db.horarios.forEach(aula => {
                const disciplina = getDisciplinaById(aula.disciplinaId);
                if (!disciplina) return;
                
                const inicioParts = aula.inicio.split(':');
                const fimParts = aula.fim.split(':');
                
                const startRow = (parseInt(inicioParts[0]) - horaInicio) * 2 + (parseInt(inicioParts[1]) / 30) + 2;
                const endRow = (parseInt(fimParts[0]) - horaInicio) * 2 + (parseInt(fimParts[1]) / 30) + 2;
                
                const col = parseInt(aula.diaSemana) + 1;

                const color = getDisciplinaColor(aula.disciplinaId);

                const item = document.createElement('div');
                item.className = 'schedule-class-item';
                item.dataset.id = aula.id;
                item.style.gridColumn = col;
                item.style.gridRow = `${startRow} / ${endRow}`;
                item.style.backgroundColor = color;
                // item.style.borderColor = tinycolor(color).darken(20).toString(); // <<< LINHA CORRIGIDA (REMOVIDA)

                item.innerHTML = `
                    <div class="schedule-class-title">${disciplina.nome}</div>
                    <div class="schedule-class-details">
                        <i class="fas fa-map-marker-alt"></i> ${aula.local || ''}<br>
                        <i class="fas fa-clock"></i> ${aula.inicio} - ${aula.fim}
                    </div>
                `;
                container.appendChild(item);
            });
        }
    }
    
    function renderTrabalhos() {
        const tbody = document.getElementById('trabalhos-tabela');
        tbody.innerHTML = '';
        if (db.trabalhos.length === 0) {
            tbody.innerHTML = `<tr><td colspan="6" class="text-center">Nenhum trabalho cadastrado.</td></tr>`;
            return;
        }
        db.trabalhos.sort((a, b) => new Date(a.entrega) - new Date(b.entrega)).forEach(t => {
            const disciplina = getDisciplinaById(t.disciplinaId);
            const statusClass = t.status === 'Pendente' ? 'bg-warning' : 'bg-success';
            const priorityClass = t.prioridade === 'high' ? 'priority-high' : t.prioridade === 'medium' ? 'priority-medium' : 'priority-low';
            const priorityText = t.prioridade === 'high' ? 'Alta' : t.prioridade === 'medium' ? 'Média' : 'Baixa';

            const row = `
                <tr>
                  <td>${disciplina ? disciplina.nome : 'N/A'}</td>
                  <td>${t.titulo}</td>
                  <td>${new Date(t.entrega + 'T00:00:00').toLocaleDateString('pt-BR')}</td>
                  <td><span class="badge ${statusClass}">${t.status}</span></td>
                  <td><span class="badge ${priorityClass}">${priorityText}</span></td>
                  <td>
                    <button class="btn btn-sm btn-outline-primary edit-trabalho" data-id="${t.id}"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-sm btn-outline-danger delete-trabalho" data-id="${t.id}"><i class="fas fa-trash"></i></button>
                  </td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }

    function renderProvas() {
        const tbody = document.getElementById('provas-tabela');
        tbody.innerHTML = '';
        if (db.provas.length === 0) {
            tbody.innerHTML = `<tr><td colspan="7" class="text-center">Nenhuma prova cadastrada.</td></tr>`;
            return;
        }
        db.provas.sort((a,b) => new Date(a.data) - new Date(b.data)).forEach(p => {
            const disciplina = getDisciplinaById(p.disciplinaId);
            const statusClass = p.status === 'Agendada' ? 'bg-warning' : 'bg-success';
            const row = `
                <tr>
                    <td>${disciplina ? disciplina.nome : 'N/A'}</td>
                    <td>${p.conteudo}</td>
                    <td>${new Date(p.data + 'T00:00:00').toLocaleDateString('pt-BR')}</td>
                    <td>${p.hora || 'N/A'}</td>
                    <td><span class="badge ${statusClass}">${p.status}</span></td>
                    <td>${p.nota !== null ? p.nota.toFixed(1) : '-'}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary edit-prova" data-id="${p.id}"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-sm btn-outline-danger delete-prova" data-id="${p.id}"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }
    
    function renderAgenda() {
        const month = currentCalendarDate.getMonth();
        const year = currentCalendarDate.getFullYear();
        const monthNames = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
        document.getElementById('calendar-month-year').textContent = `${monthNames[month]} ${year}`;

        const weekdaysContainer = document.getElementById('calendar-weekdays');
        const daysContainer = document.getElementById('calendar-days');
        weekdaysContainer.innerHTML = '';
        daysContainer.innerHTML = '';

        const weekdays = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
        weekdays.forEach(day => {
            weekdaysContainer.innerHTML += `<div class="col text-center"><strong>${day}</strong></div>`;
        });
        
        const firstDayOfMonth = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        let currentRow = document.createElement('div');
        currentRow.className = 'row mb-2';

        for (let i = 0; i < firstDayOfMonth; i++) {
            currentRow.innerHTML += `<div class="col calendar-day empty"></div>`;
        }

        for (let day = 1; day <= daysInMonth; day++) {
            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const dayEvents = getEventsForDate(dateStr);
            let dayClasses = 'col calendar-day';
            let eventIndicator = '';

            if (dayEvents.length > 0) {
                dayClasses += ' has-event';
                eventIndicator += '<div class="event-indicator">';
                if (dayEvents.some(e => e.type === 'assignment')) eventIndicator += '<span class="event-dot assignment"></span>';
                if (dayEvents.some(e => e.type === 'exam')) eventIndicator += '<span class="event-dot exam"></span>';
                if (dayEvents.some(e => e.type === 'other' || e.type === 'class')) eventIndicator += '<span class="event-dot other"></span>';
                eventIndicator += '</div>';
            }
            
            currentRow.innerHTML += `<div class="${dayClasses}" data-date="${dateStr}">${day}${eventIndicator}</div>`;

            if ((day + firstDayOfMonth) % 7 === 0 || day === daysInMonth) {
                daysContainer.appendChild(currentRow);
                currentRow = document.createElement('div');
                currentRow.className = 'row mb-2';
            }
        }
    }

    function renderRelatorios() {
        const relatorioDesempenho = document.getElementById('relatorio-desempenho');
        relatorioDesempenho.innerHTML = '';
        db.disciplinas.forEach(d => {
            const notas = [...db.trabalhos.filter(t => t.disciplinaId === d.id && t.nota !== null).map(t => parseFloat(t.nota)), ...db.provas.filter(p => p.disciplinaId === d.id && p.nota !== null).map(p => parseFloat(p.nota))];
            const media = notas.length > 0 ? (notas.reduce((a,b) => a+b, 0) / notas.length).toFixed(1) : "N/A";
            const badgeClass = media >= 7 ? 'bg-success' : media >= 5 ? 'bg-warning' : 'bg-danger';
            relatorioDesempenho.innerHTML += `<div class="report-item"><span>${d.nome}</span><span class="badge ${badgeClass}">${media}</span></div>`;
        });
        
        const relatorioFrequencia = document.getElementById('relatorio-frequencia');
        relatorioFrequencia.innerHTML = '';
        db.disciplinas.forEach(d => relatorioFrequencia.innerHTML += `<div class="report-item"><span>${d.nome}</span><span class="badge ${d.frequencia >= 75 ? 'bg-success' : 'bg-warning'}">${d.frequencia}%</span></div>`);
        
        const relatorioTrabalhos = document.getElementById('relatorio-trabalhos');
        relatorioTrabalhos.innerHTML = '';
        db.disciplinas.forEach(d => relatorioTrabalhos.innerHTML += `<div class="report-item"><span>${d.nome}</span><span class="badge bg-primary">${db.trabalhos.filter(t => t.disciplinaId === d.id && t.status === 'Entregue').length}/${db.trabalhos.filter(t => t.disciplinaId === d.id).length}</span></div>`);
        
        const relatorioProvas = document.getElementById('relatorio-provas');
        relatorioProvas.innerHTML = `<div class="empty-state"><p>${db.provas.filter(p => p.status === 'Realizada').length > 0 ? '' : 'Nenhuma prova realizada.'}</p></div>`;
        db.provas.filter(p => p.status === 'Realizada').forEach(p => {
             const disciplina = getDisciplinaById(p.disciplinaId);
             relatorioProvas.innerHTML += `<div class="report-item"><span>${disciplina.nome} - ${p.conteudo}</span><span class="badge ${p.nota >= 7 ? 'bg-success' : p.nota >= 5 ? 'bg-warning' : 'bg-danger'}">${p.nota.toFixed(1)}</span></div>`;
        });
    }

    function getEventsForDate(dateStr) {
        return [
            ...db.trabalhos.filter(t => t.entrega === dateStr).map(t => ({...t, type: 'assignment', date: t.entrega, title: t.titulo})),
            ...db.provas.filter(p => p.data === dateStr).map(p => ({...p, type: 'exam', date: p.data, title: p.conteudo})),
            ...db.eventos.filter(e => e.date === dateStr)
        ];
    }
    
    //-----------------------------------------------------
    // 4. MANIPULAÇÃO DE EVENTOS E MODAIS
    //-----------------------------------------------------
    
    // Navegação
    document.body.addEventListener('click', function(e) {
        if (e.target.closest('.nav-link, .card-link')) {
            e.preventDefault();
            const targetId = e.target.closest('.nav-link, .card-link').dataset.target;
            document.querySelectorAll('.content-panel').forEach(p => p.classList.remove('active'));
            document.getElementById(targetId).classList.add('active');
            document.querySelectorAll('.nav-link').forEach(nl => nl.classList.remove('active'));
            document.querySelector(`.nav-link[data-target="${targetId}"]`).classList.add('active');
        }
    });

    document.getElementById('sidebarToggle').addEventListener('click', () => document.getElementById('sidebar').classList.toggle('open'));

    function populateDisciplinaSelects() {
        const selects = document.querySelectorAll('#trabalhoDisciplina, #provaDisciplina, #horarioDisciplina');
        const options = db.disciplinas.map(d => `<option value="${d.id}">${d.nome}</option>`).join('');
        selects.forEach(select => { if (select) select.innerHTML = options; });
    }

    // Gerenciamento de Horários
    document.getElementById('saveHorario').addEventListener('click', () => {
        const id = document.getElementById('horarioId').value;
        const aula = {
            disciplinaId: parseInt(document.getElementById('horarioDisciplina').value),
            diaSemana: document.getElementById('horarioDiaSemana').value,
            inicio: document.getElementById('horarioInicio').value,
            fim: document.getElementById('horarioFim').value,
            local: document.getElementById('horarioLocal').value
        };

        if (!aula.disciplinaId || !aula.inicio || !aula.fim) { alert('Preencha os campos obrigatórios.'); return; }

        if (id) {
            const index = db.horarios.findIndex(h => h.id == id);
            db.horarios[index] = { ...db.horarios[index], ...aula };
        } else {
            aula.id = db.horarios.length > 0 ? Math.max(...db.horarios.map(h => h.id)) + 1 : 1;
            db.horarios.push(aula);
        }
        
        saveDB();
        renderAll();
        bootstrap.Modal.getInstance(document.getElementById('horarioModal')).hide();
    });

    document.getElementById('deleteHorario').addEventListener('click', function() {
        const id = document.getElementById('horarioId').value;
        if(confirm('Tem certeza que deseja excluir esta aula?')) {
            db.horarios = db.horarios.filter(h => h.id != id);
            saveDB();
            renderAll();
            bootstrap.Modal.getInstance(document.getElementById('horarioModal')).hide();
        }
    });

    // Gerenciamento de Disciplinas, Trabalhos, Provas
    document.getElementById('saveDisciplina').addEventListener('click', () => {
        const id = document.getElementById('disciplinaId').value;
        const disciplina = {
            nome: document.getElementById('disciplinaNome').value,
            professor: document.getElementById('disciplinaProfessor').value,
            frequencia: parseInt(document.getElementById('disciplinaFrequencia').value)
        };
        if (!disciplina.nome) { alert('O nome da disciplina é obrigatório.'); return; }
        if (id) {
            const index = db.disciplinas.findIndex(d => d.id == id);
            db.disciplinas[index] = { ...db.disciplinas[index], ...disciplina };
        } else {
            disciplina.id = db.disciplinas.length > 0 ? Math.max(...db.disciplinas.map(d => d.id)) + 1 : 1;
            db.disciplinas.push(disciplina);
        }
        saveDB(); renderAll(); bootstrap.Modal.getInstance(document.getElementById('disciplinaModal')).hide();
    });
    
    document.getElementById('saveTrabalho').addEventListener('click', () => {
        const id = document.getElementById('trabalhoId').value;
        const trabalho = {
            disciplinaId: parseInt(document.getElementById('trabalhoDisciplina').value),
            titulo: document.getElementById('trabalhoTitulo').value,
            entrega: document.getElementById('trabalhoEntrega').value,
            status: document.getElementById('trabalhoStatus').value,
            prioridade: document.getElementById('trabalhoPrioridade').value,
            nota: document.getElementById('trabalhoNota').value === '' ? null : parseFloat(document.getElementById('trabalhoNota').value)
        };
        if (!trabalho.disciplinaId || !trabalho.titulo || !trabalho.entrega) { alert('Preencha os campos obrigatórios.'); return; }
        if (id) {
            const index = db.trabalhos.findIndex(t => t.id == id);
            db.trabalhos[index] = { ...db.trabalhos[index], ...trabalho };
        } else {
            trabalho.id = db.trabalhos.length > 0 ? Math.max(...db.trabalhos.map(t => t.id)) + 1 : 1;
            db.trabalhos.push(trabalho);
        }
        saveDB(); renderAll(); bootstrap.Modal.getInstance(document.getElementById('trabalhoModal')).hide();
    });
    
    document.getElementById('saveProva').addEventListener('click', () => {
        const id = document.getElementById('provaId').value;
        const prova = {
            disciplinaId: parseInt(document.getElementById('provaDisciplina').value),
            conteudo: document.getElementById('provaConteudo').value,
            data: document.getElementById('provaData').value,
            hora: document.getElementById('provaHora').value,
            status: document.getElementById('provaStatus').value,
            nota: document.getElementById('provaNota').value === '' ? null : parseFloat(document.getElementById('provaNota').value)
        };
        if (!prova.disciplinaId || !prova.conteudo || !prova.data) { alert('Preencha os campos obrigatórios.'); return; }
        if (id) {
            const index = db.provas.findIndex(p => p.id == id);
            db.provas[index] = { ...db.provas[index], ...prova };
        } else {
            prova.id = db.provas.length > 0 ? Math.max(...db.provas.map(p => p.id)) + 1 : 1;
            db.provas.push(prova);
        }
        saveDB(); renderAll(); bootstrap.Modal.getInstance(document.getElementById('provaModal')).hide();
    });

    document.getElementById('saveEvent').addEventListener('click', () => {
        const evento = {
            title: document.getElementById('eventTitle').value,
            type: document.getElementById('eventType').value,
            date: document.getElementById('eventDate').value,
            time: document.getElementById('eventTime').value,
            description: document.getElementById('eventDescription').value
        };
        if (!evento.title || !evento.type || !evento.date) { alert('Preencha os campos obrigatórios.'); return; }
        evento.id = db.eventos.length > 0 ? Math.max(...db.eventos.map(e => e.id)) + 1 : 1;
        db.eventos.push(evento);
        saveDB(); renderAll(); bootstrap.Modal.getInstance(document.getElementById('eventModal')).hide();
    });

    document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('hidden.bs.modal', () => {
            modal.querySelector('form').reset();
            modal.querySelectorAll('input[type="hidden"]').forEach(i => i.value = '');
            // Hide delete button in horarioModal
            if (modal.id === 'horarioModal') {
                document.getElementById('deleteHorario').classList.add('d-none');
            }
        });
    });
    
    document.body.addEventListener('click', function(e) {
        let id, element;
        if (e.target.closest('.edit-disciplina')) {
            e.preventDefault(); id = e.target.closest('.edit-disciplina').dataset.id;
            element = db.disciplinas.find(d => d.id == id);
            Object.keys(element).forEach(key => {
                const input = document.getElementById(`disciplina${key.charAt(0).toUpperCase() + key.slice(1)}`);
                if(input) input.value = element[key];
            });
            document.getElementById('disciplinaId').value = id;
            new bootstrap.Modal(document.getElementById('disciplinaModal')).show();
        } else if (e.target.closest('.delete-disciplina')) {
            e.preventDefault(); id = e.target.closest('.delete-disciplina').dataset.id;
            if (confirm('Tem certeza que deseja excluir esta disciplina e todos os seus dados associados?')) {
                db.disciplinas = db.disciplinas.filter(d => d.id != id);
                db.trabalhos = db.trabalhos.filter(t => t.disciplinaId != id);
                db.provas = db.provas.filter(p => p.disciplinaId != id);
                db.horarios = db.horarios.filter(h => h.disciplinaId != id);
                saveDB(); renderAll();
            }
        } else if (e.target.closest('.edit-trabalho, .delete-trabalho')) {
            id = e.target.closest('button').dataset.id;
            if (e.target.closest('.edit-trabalho')) {
                element = db.trabalhos.find(item => item.id == id);
                Object.keys(element).forEach(key => {
                    const input = document.getElementById(`trabalho${key.charAt(0).toUpperCase() + key.slice(1)}`);
                    if(input) input.value = element[key];
                });
                document.getElementById('trabalhoId').value = id;
                new bootstrap.Modal(document.getElementById('trabalhoModal')).show();
            } else if (confirm('Tem certeza?')) {
                db.trabalhos = db.trabalhos.filter(item => item.id != id);
                saveDB(); renderAll();
            }
        } else if (e.target.closest('.edit-prova, .delete-prova')) {
            id = e.target.closest('button').dataset.id;
             if (e.target.closest('.edit-prova')) {
                element = db.provas.find(item => item.id == id);
                Object.keys(element).forEach(key => {
                    const input = document.getElementById(`prova${key.charAt(0).toUpperCase() + key.slice(1)}`);
                    if(input) input.value = element[key];
                });
                document.getElementById('provaId').value = id;
                new bootstrap.Modal(document.getElementById('provaModal')).show();
            } else if (confirm('Tem certeza?')) {
                db.provas = db.provas.filter(item => item.id != id);
                saveDB(); renderAll();
            }
        } else if (e.target.closest('.schedule-class-item')) {
            id = e.target.closest('.schedule-class-item').dataset.id;
            element = db.horarios.find(h => h.id == id);
            document.getElementById('horarioId').value = element.id;
            document.getElementById('horarioDisciplina').value = element.disciplinaId;
            document.getElementById('horarioDiaSemana').value = element.diaSemana;
            document.getElementById('horarioInicio').value = element.inicio;
            document.getElementById('horarioFim').value = element.fim;
            document.getElementById('horarioLocal').value = element.local;
            document.getElementById('deleteHorario').classList.remove('d-none');
            new bootstrap.Modal(document.getElementById('horarioModal')).show();
        }
    });

    document.getElementById('prev-month').addEventListener('click', () => { currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1); renderAgenda(); });
    document.getElementById('next-month').addEventListener('click', () => { currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1); renderAgenda(); });
    
    document.getElementById('calendar-days').addEventListener('click', (e) => {
        if (e.target.classList.contains('calendar-day') && !e.target.classList.contains('empty')) {
            const date = e.target.dataset.date;
            const container = document.getElementById('agenda-eventos-dia');
            const events = getEventsForDate(date);
            document.querySelectorAll('.calendar-day.current').forEach(d => d.classList.remove('current'));
            e.target.classList.add('current');
            container.innerHTML = `<h4 class="card-title mb-4">Eventos do Dia ${new Date(date + 'T00:00:00').toLocaleDateString('pt-BR')}</h4>`;
            if (events.length === 0) {
                container.innerHTML += `<p class="text-muted text-center">Nenhum evento agendado</p>`;
            } else {
                events.forEach(evento => container.innerHTML += `<div class="event-item ${evento.type}"><h6 class="mb-0">${evento.title}</h6><p class="mb-0 small">${evento.time || ''}</p></div>`);
            }
        }
    });
    
    //-----------------------------------------------------
    // 5. BACKUP E RESTAURAÇÃO
    //-----------------------------------------------------

    document.getElementById('backup-btn').addEventListener('click', () => {
        const dataStr = JSON.stringify(db, null, 2);
        const link = document.createElement('a');
        link.href = URL.createObjectURL(new Blob([dataStr], { type: 'application/json' }));
        link.download = `lex_academica_backup_${new Date().toISOString().slice(0, 10)}.json`;
        link.click();
        URL.revokeObjectURL(link.href);
        alert('Backup criado com sucesso!');
    });

    document.getElementById('restore-input').addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (!file || !confirm('Restaurar este backup substituirá todos os dados atuais. Continuar?')) { event.target.value = ''; return; }
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const restoredDb = JSON.parse(e.target.result);
                if (restoredDb.disciplinas && restoredDb.trabalhos && restoredDb.provas) {
                    db = restoredDb;
                    saveDB();
                    alert('Backup restaurado! A página será recarregada.');
                    location.reload();
                } else { alert('Arquivo de backup inválido.'); }
            } catch (error) { alert('Erro ao ler o arquivo de backup.'); } 
            finally { event.target.value = ''; }
        };
        reader.readAsText(file);
    });

    // Lib para ajudar a manipular cores (necessário para o quadro de horários)
    !function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a.tinycolor=b())}(this,function(){function a(b,d){if(b=b?b:"",d=d||{},b instanceof a)return b;if(!(this instanceof a))return new a(b,d);var e=c(b);this._originalInput=b,this._r=e.r,this._g=e.g,this._b=e.b,this._a=e.a,this._roundA=P(100*this._a)/100,this._format=d.format||e.format,this._gradientType=d.gradientType,this._r<1&&(this._r=P(this._r)),this._g<1&&(this._g=P(this._g)),this._b<1&&(this._b=P(this._b)),this._ok=e.ok,this._tc_id=O++}function c(a){var c={r:0,g:0,b:0},d=1,e=null,f=null,g=null,h=!1,i=!1;return"string"==typeof a&&(a=M(a)),"object"==typeof a&&(J(a.r)&&J(a.g)&&J(a.b)?(c=f(a.r,a.g,a.b),h=!0,i="%_rgb"===String(a.r).substr(-1)?"%":"rgb"):"object"==typeof a&&J(a.h)&&J(a.s)&&J(a.v)?(f=l(a.h,a.s,a.v),c={r:f.r,g:f.g,b:f.b},h=!0,i="hsv"):"object"==typeof a&&J(a.h)&&J(a.s)&&J(a.l)&&(f=j(a.h,a.s,a.l),c={r:f.r,g:f.g,b:f.b},h=!0,i="hsl"),a.hasOwnProperty("a")&&(d=a.a)),d=z(d),{ok:h,format:a.format||i,r:Q(255,R(c.r,0)),g:Q(255,R(c.g,0)),b:Q(255,R(c.b,0)),a:d}}function d(a){var b,c,d,e,f,g;return a=y(a,/%$/,""),b=N(a),c=N(a.substr(0,1)),d=N(a.substr(1,1)),e=N(a.substr(2,1)),f=N(a.substr(3,1)),g=N(a.substr(4,1)),b.length<5?b.length<3?b.length<2?{r:c,g:c,b:c}:{r:c,g:c,b:d}:{r:17*c,g:17*d,b:17*e}:{r:17*c,g:17*d,b:17*e,a:17*f}}function e(a){var c=a.r,d=a.g,e=a.b;return{r:17*N(c),g:17*N(d),b:17*N(e)}}function f(a,b,c){return{r:255*A(a,255),g:255*A(b,255),b:255*A(c,255)}}function g(a,b,c){a=A(a,255),b=A(b,255),c=A(c,255);var d,e,f=R(a,b,c),g=Q(a,b,c),h=(f+g)/2;if(f==g)d=e=0;else{var i=f-g;switch(e=h>.5?i/(2-f-g):i/(f+g),f){case a:d=(b-c)/i+(b<c?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}d/=6}return{h:d,s:e,l:h}}function h(a,b,c){a=A(a,255),b=A(b,255),c=A(c,255);var d,e,f=R(a,b,c),g=Q(a,b,c),h=f,i=f-g;if(e=0===f?0:i/f,f==g)d=0;else{switch(f){case a:d=(b-c)/i+(b<c?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}d/=6}return{h:d,s:e,v:h}}function i(a,b,c,d){var e=[L(P(a).toString(16)),L(P(b).toString(16)),L(P(c).toString(16))];return d&&e[0].charAt(0)==e[0].charAt(1)&&e[1].charAt(0)==e[1].charAt(1)&&e[2].charAt(0)==e[2].charAt(1)?e[0].charAt(0)+e[1].charAt(0)+e[2].charAt(0):e.join("")}function j(a,b,c){function d(a,b,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?a+6*(b-a)*c:c<.5?b:c<2/3?a+6*(b-a)*(2/3-c):a}var e,f,g;if(a=A(a,360),b=A(b,100),c=A(c,100),0===b)e=f=g=c;else{var h=c<.5?c*(1+b):c+b-c*b,i=2*c-h;e=d(i,h,a+1/3),f=d(i,h,a),g=d(i,h,a-1/3)}return{r:255*e,g:255*f,b:255*g}}function k(a,b,c,d){var e=b/100,f=c/100;return{r:j(a,e,f).r,g:j(a,e,f).g,b:j(a,e,f).b,a:d}}function l(a,b,c){a=A(a,360),b=A(b,100),c=A(c,100);var d=Math.floor(a/60)%6,e=a/60-d,f=c*(1-b),g=c*(1-e*b),h=c*(1-(1-e)*b),i=[[c,h,f],[g,c,f],[f,c,h],[f,g,c],[h,f,c],[c,f,g]][d];return{r:255*i[0],g:255*i[1],b:255*i[2]}}function m(a,b,c,d){var e=b/100,f=c/100;return{r:l(a,e,f).r,g:l(a,e,f).g,b:l(a,e,f).b,a:d}}function n(a,b,c,d){a=A(a,255),b=A(b,255),c=A(c,255);var e=i(a,b,c);return{r:N("0x"+e.substring(0,2)),g:N("0x"+e.substring(2,4)),b:N("0x"+e.substring(4,6)),a:d}}function o(b,c){var e=a(b).toHsl();return e.s-=.1*c,e.s=B(e.s),a(e)}function p(b,c){var d=a(b).toHsl();return d.s+=.1*c,d.s=B(d.s),a(d)}function q(b,c){return a(b).greyscale().desaturate(c)}function r(b,c){return a(b).greyscale().saturate(c)}function s(b,c){var d=a(b).toHsl();return d.l+=.1*c,d.l=B(d.l),a(d)}function t(b,c){var d=a(b).toHsl();return d.l-=.1*c,d.l=B(d.l),a(d)}function u(b,c){var d=a(b).toHsl();return d.h=(d.h+c)%360,d.h<0&&(d.h+=360),a(d)}function v(b,c){var d=a(b).toHsl();return d.h=(d.h-c)%360,d.h<0&&(d.h+=360),a(d)}function w(b,c){var d=a(b).toHsl(),e=a(c).toHsl();return a({h:(d.h+e.h)/2,s:(d.s+e.s)/2,l:(d.l+e.l)/2})}function x(a,b,c,d){var e=b/100,f=d/100;switch(c){case"rgb":return{r:a.r,g:a.g,b:a.b,a:f};case"hsl":return k(a.h,a.s,a.l,f);case"hsv":return m(a.h,a.s,a.v,f)}return{}}var y=function(){var a="[\\s|\\(]+",b="[\\s|\\)]+",c="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)",d="[\\s|\\(]+("+c+")[,|\\s]+("+c+")[,|\\s]+("+c+")\\s*"+b,e="[\\s|\\(]+("+c+")[,|\\s]+("+c+")[,|\\s]+("+c+")[,|\\s]+("+c+")\\s*"+b;return{CSS_UNIT:new RegExp(c),rgb:new RegExp("rgb"+d),rgba:new RegExp("rgba"+e),hsl:new RegExp("hsl"+d),hsla:new RegExp("hsla"+e),hsv:new RegExp("hsv"+d),hsva:new RegExp("hsva"+e),hex3:/(#)?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})/,hex6:/(#)?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})/,hex4:/(#)?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})/,hex8:/(#)?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})/}}(),z=function(a){return a=parseFloat(a),isNaN(a)||a<0||a>1?1:a},A=function(a,b){"string"==typeof a&&-1!=a.indexOf(".")&&1===parseFloat(a)&&(a="100%");var c="string"==typeof a&&-1!=a.indexOf("%");return a=Q(b,R(0,parseFloat(a))),c&&(a=parseInt(a*b,10)/100),Math.abs(a-b)<1e-6?1:a%b/parseFloat(b)},B=function(a){return Q(1,R(0,a))},C=function(a){return a.length>1?a:0+a},D=function(a){return a.length>2?a:L(a)},E=function(a,b){return b=b||null,null!==b?b:F[a]},F={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},G=function(a){var b,c,d,e,g={},h=a.match(y.rgb),i=a.match(y.rgba),j=a.match(y.hsl),k=a.match(y.hsla),l=a.match(y.hsv),m=a.match(y.hsva),n=a.match(y.hex8),o=a.match(y.hex6),p=a.match(y.hex4),q=a.match(y.hex3),r=!1;return"red"===a?(b=F.red,r=!0):"blue"===a?(b=F.blue,r=!0):"green"===a&&(b=F.green,r=!0),h&&(g={r:h[1],g:h[2],b:h[3]}),i&&(g={r:i[1],g:i[2],b:i[3],a:i[4]}),j&&(g={h:j[1],s:j[2],l:j[3]}),k&&(g={h:k[1],s:k[2],l:k[3],a:k[4]}),l&&(g={h:l[1],s:l[2],v:l[3]}),m&&(g={h:m[1],s:m[2],v:m[3],a:m[4]}),n&&(g={r:N(n[2]),g:N(n[3]),b:N(n[4]),a:C(n[5]),format:r?"name":"hex8"}),o&&(g={r:N(o[2]),g:N(o[3]),b:N(o[4]),format:r?"name":"hex"}),p&&(g={r:N(p[2].toString()+p[2].toString()),g:N(p[3].toString()+p[3].toString()),b:N(p[4].toString()+p[4].toString()),a:C(p[5].toString()+p[5].toString()),format:r?"name":"hex8"}),q&&(g={r:N(q[2].toString()+q[2].toString()),g:N(q[3].toString()+q[3].toString()),b:N(q[4].toString()+q[4].toString()),format:r?"name":"hex"}),g.ok=!1,r||(g=H(a)),g},H=function(a){var b,c=a.match(/^([a-z A-Z]+)$/);return c&&(b=c[1],b=b.toLowerCase(),E(b)?(b=E(b),{r:N(b.substring(0,2)),g:N(b.substring(2,4)),b:N(b.substring(4,6)),format:"name"}):{ok:!1})},I=function(a){var b,c;return b=a.r,c=a.g,a=a.b,b=A(b,255),c=A(c,255),a=A(a,255),"("+[P(b),P(c),P(a)].join(",")+")"},J=function(a){return"number"==typeof a},K=function(a){return y.CSS_UNIT.test(a)},L=function(a){return 1==a.length?"0"+a:String(a)},M=function(a){return a=a.replace(/^\s+/,"").replace(/\s+$/,"").toLowerCase(),E(a)?E(a):(a=a.replace(/^#/,""),{r:a.substring(0,2),g:a.substring(2,4),b:a.substring(4,6)})},N=function(a,b){return b=b||16,parseInt(a,b)},O=0,P=Math.round,Q=Math.min,R=Math.max;return a.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var a=this.toRgb();return(299*a.r+587*a.g+114*a.b)/1e3},getLuminance:function(){var a,b,c,d,e,f,g=this.toRgb();return a=g.r/255,b=g.g/255,c=g.b/255,d=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4),e=b<=.03928?b/12.92:Math.pow((b+.055)/1.055,2.4),f=c<=.03928?c/12.92:Math.pow((c+.055)/1.055,2.4),.2126*d+.7152*e+.0722*f},setAlpha:function(a){return this._a=z(a),this._roundA=P(100*this._a)/100,this},toHsv:function(){var a=h(this._r,this._g,this._b);return{h:360*a.h,s:100*a.s,v:100*a.v,a:this._a}},toHsvString:function(){var a=h(this._r,this._g,this._b),b=P(360*a.h),c=P(100*a.s),d=P(100*a.v);return 1==this._a?"hsv("+b+", "+c+"%, "+d+"%)":"hsva("+b+", "+c+"%, "+d+"%, "+this._roundA+")"},toHsl:function(){var a=g(this._r,this._g,this._b);return{h:360*a.h,s:100*a.s,l:100*a.l,a:this._a}},toHslString:function(){var a=g(this._r,this._g,this._b),b=P(360*a.h),c=P(100*a.s),d=P(100*a.l);return 1==this._a?"hsl("+b+", "+c+"%, "+d+"%)":"hsla("+b+", "+c+"%, "+d+"%, "+this._roundA+")"},toHex:function(a){return i(this._r,this._g,this._b,a)},toHexString:function(a){return"#"+this.toHex(a)},toHex8:function(a){var b,c,d,e,f;return b=this._r,c=this._g,d=this._b,e=this._a,f=this.toHex(a),L(P(255*e).toString(16))+f},toHex8String:function(a){return"#"+this.toHex8(a)},toRgb:function(){return{r:P(this._r),g:P(this._g),b:P(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+P(this._r)+", "+P(this._g)+", "+P(this._b)+")":"rgba("+P(this._r)+", "+P(this._g)+", "+P(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:P(100*A(this._r,255))+"%",g:P(100*A(this._g,255))+"%",b:P(100*A(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+P(100*A(this._r,255))+"%, "+P(100*A(this._g,255))+"%, "+P(100*A(this._b,255))+"%)":"rgba("+P(100*A(this._r,255))+"%, "+P(100*A(this._g,255))+"%, "+P(100*A(this._b,255))+"%, "+this._roundA+")"},toName:function(){if(0===this._a)return"transparent";if(this._a<1)return!1;for(var b="#"+i(this._r,this._g,this._b,!1),c=0,d=Object.keys(F);c<d.length;c++)if(F[d[c]]==b)return d[c];return!1},toFilter:function(b){var c="#"+this.toHex8(!0),d=this.toRgb(),e=d.r,f=d.g,g=d.b;return this._a,b=b||"IE",("DXImageTransform.Microsoft.gradient(startColorstr="+c+",endColorstr="+c+")"===b||"Filter"===b)&&"progid:DXImageTransform.Microsoft.gradient(startColorstr="+c+",endColorstr="+c+")"},toString:function(a){var b=!!a;a=a||this._format;var c=!1,d=this._a<1&&this._a>=0,e=!b&&d&&("hex"===a||"hex6"===a||"hex3"===a||"hex4"===a||"hex8"===a||"name"===a);return e?this.toRgbString():("rgb"===a&&(c=this.toRgbString()),"prgb"===a&&(c=this.toPercentageRgbString()),"hex"!==a&&"hex6"!==a||(c=this.toHexString()),"hex3"===a&&(c=this.toHexString(!0)),"hex4"===a&&(c=this.toHex8String(!0)),"hex8"===a&&(c=this.toHex8String()),"name"===a&&(c=this.toName()),"hsl"===a&&(c=this.toHslString()),"hsv"===a&&(c=this.toHsvString()),c||this.toHexString())},clone:function(){return new a(this.toString())},_applyModification:function(b,c){var d=b.apply(null,[this].concat([].slice.call(c)));return this._r=d._r,this._g=d._g,this._b=d._b,this.setAlpha(d._a),this},lighten:function(){return this._applyModification(s,arguments)},brighten:function(){return this._applyModification(s,arguments)},darken:function(){return this._applyModification(t,arguments)},desaturate:function(){return this._applyModification(o,arguments)},saturate:function(){return this._applyModification(p,arguments)},greyscale:function(){return this._applyModification(q,arguments)},spin:function(){return this._applyModification(u,arguments)},_applyCombination:function(b,c){var d=b.apply(null,[this].concat([].slice.call(c)));return this._r=d._r,this._g=d._g,this._b=d._b,this.setAlpha(d._a),this},analogous:function(b,c){b=b||6,c=c||30;for(var d=this.toHsv(),e=[this],f=d.h,g=1;g<b;g++){var h=f+(g%2===0?-(Math.ceil(g/2)-1):Math.ceil(g/2))*c,i=d.s,j=d.v;e.push(a({h:h,s:i,v:j}))}return e},complement:function(){var b=this.toHsv();return b.h=(b.h+180)%360,a(b)},monochromatic:function(b){b=b||6;for(var c=this.toHsv(),d=c.h,e=c.s,f=[this],g=1/b;b>f.length;){var h=f.length*g,i=c.v;i=(i+h)%1,e>0&&(i=c.v),f.push(a({h:d,s:e,v:i}))}return f},splitcomplement:function(){var b=this.toHsv(),c=b.h;return[this,a({h:(c+72)%360,s:b.s,v:b.v}),a({h:(c+216)%360,s:b.s,v:b.v})]},triad:function(){var b=this.toHsv(),c=b.h;return[this,a({h:(c+120)%360,s:b.s,v:b.v}),a({h:(c+240)%360,s:b.s,v:b.v})]},tetrad:function(){var b=this.toHsv(),c=b.h;return[this,a({h:(c+90)%360,s:b.s,v:b.v}),a({h:(c+180)%360,s:b.s,v:b.v}),a({h:(c+270)%360,s:b.s,v:b.v})]},isReadable:function(c,d){var e=this.getLuminance(),f=a(c).getLuminance();return R(e,f)+.05/(Q(e,f)+.05)>=d}},a.fromRatio=function(b,c){if("object"==typeof b){var d={};for(var e in b)b.hasOwnProperty(e)&&(d[e]="%"===e.substr(-1)?b[e]:100*b[e]);b=d}return new a(b,c)},a.equals=function(b,c){return!(!b||!c)&&a(b).toRgbString()==a(c).toRgbString()},a.random=function(){return a.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})},a.mix=function(b,c,d){d=0===d?0:d||50;var e=a(b).toRgb(),f=a(c).toRgb(),g=d/100,h={r:(f.r-e.r)*g+e.r,g:(f.g-e.g)*g+e.g,b:(f.b-e.b)*g+e.b,a:(f.a-e.a)*g+e.a};return new a(h)},a.readability=function(b,c){var d=a(b),e=a(c);return(R(d.getLuminance(),e.getLuminance())+.05)/(Q(d.getLuminance(),e.getLuminance())+.05)},a.mostReadable=function(b,c,d){var e,f,g=null,h=0;d=d||{includeFallbackColors:!1,level:"AA",size:"small"};var i=d.level||"AA",j=d.size||"small";for(e=0;e<c.length;e++)f=a.readability(b,c[e]),f>h&&(h=f,g=a(c[e]));return h<a.WCAG2[i][j]&&d.includeFallbackColors?(g=a.WCAG2.fallback,g||(g=b,g=g.isLight()?a("black"):a("white"))):g},a.names=F,a.WCAG2={fallback:null,AA:{small:4.5,large:3},AAA:{small:7,large:4.5}},a});

    // Inicialização da aplicação
    init();
});
</script>
</body>
</html>
